{
  "hash": "73fedb5e8f9d361f14a585f8d9ff896d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"2-Data Wrangling\"\nsubtitle: \" \"\nauthor: \"Felipe Melo\"\ninstitute: \"Nottingham Trent University - UK\"\nfrom: markdown+emoji\nformat:\n  revealjs:\n    theme: [default, custom.scss]\n    incremental: false\n    chalkboard: true\n    logo: img/ntu_logo.png\n    #footer: \"Research Methods & Data Analysis\"\n    slide-number: true\n    transition: slide\n    background-transition: fade\n    #auto-stretch: true\n    title-block-banner: true\n    embed-resources: false\n\n---\n\n\n\n## You should know today\n\n- Why data wrangling?\n- How to plan data wrangling\n- Basic skills\n- Application with an example\n\n\n## Before we begin\n\n::::{.columns}\n:::{.column width=\"50%\"}\n\n![](img/attention.png)\n\n:::\n\n:::{.column width=\"50%\"}\n- R and Rstudio installed\n- Don't panic\n- Everything is reproducible\n- You'll have to train to fix the content\n\n\n:::\n::::\n\n## [Tibbles](https://tibble.tidyverse.org/) <- click on the title\n\n\n\n::: {.cell output-location='default'}\n\n```{.r .cell-code  code-line-numbers=\"|,4,5\"}\nlibrary(tidyverse)\nlibrary(palmerpenguins)\n\ndata(\"penguins\")\npenguins %>% \n  select(1:5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 344 × 5\n   species island    bill_length_mm bill_depth_mm flipper_length_mm\n   <fct>   <fct>              <dbl>         <dbl>             <int>\n 1 Adelie  Torgersen           39.1          18.7               181\n 2 Adelie  Torgersen           39.5          17.4               186\n 3 Adelie  Torgersen           40.3          18                 195\n 4 Adelie  Torgersen           NA            NA                  NA\n 5 Adelie  Torgersen           36.7          19.3               193\n 6 Adelie  Torgersen           39.3          20.6               190\n 7 Adelie  Torgersen           38.9          17.8               181\n 8 Adelie  Torgersen           39.2          19.6               195\n 9 Adelie  Torgersen           34.1          18.1               193\n10 Adelie  Torgersen           42            20.2               190\n# ℹ 334 more rows\n```\n\n\n:::\n:::\n\n\n![](https://tibble.tidyverse.org/logo.svg){.absolute top=10 right=10 width=\"10%\"}\n\n## Your turn\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"countdown\" id=\"timer_f601e6c6\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">02</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">15</span></code>\n</div>\n```\n\n:::\n:::\n\n\n\n\n1- Load tidyverse\n\n2- load \"palmerpenguins\" dataset\n\n3- call the data\n\n  - type penguins\n\n\n## The PIPE\n\n::::{.columns}\n:::{.column width=\"30%\"}\n\n![](https://magrittr.tidyverse.org/logo.png)\n\nmore about the package [magrittr](https://magrittr.tidyverse.org/reference/pipe.html)\n\n:::\n\n:::{.column width=\"70%\" .fragment}\n\n- \"Take what is on the left and use it as the first argument on what comes next\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>% # take the opbject penguins\n  select(1:3) # then, select the columns 1 to 3\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 344 × 3\n   species island    bill_length_mm\n   <fct>   <fct>              <dbl>\n 1 Adelie  Torgersen           39.1\n 2 Adelie  Torgersen           39.5\n 3 Adelie  Torgersen           40.3\n 4 Adelie  Torgersen           NA  \n 5 Adelie  Torgersen           36.7\n 6 Adelie  Torgersen           39.3\n 7 Adelie  Torgersen           38.9\n 8 Adelie  Torgersen           39.2\n 9 Adelie  Torgersen           34.1\n10 Adelie  Torgersen           42  \n# ℹ 334 more rows\n```\n\n\n:::\n:::\n\n\n\n:::\n::::\n\n## Why data wrangling\n\n- your data is NEVER ready to analyse\n- you need to get to know your data\n- do some inspections\n- ask some questions\n\n## {background-image=\"https://media.licdn.com/dms/image/v2/C5612AQFIS6Q8CBEWHQ/article-cover_image-shrink_720_1280/article-cover_image-shrink_720_1280/0/1520242783151?e=1732147200&v=beta&t=zkmPqo85HLNtJJuEHZG4nHmnVHQM_ezLxAchuKxc3wI\"}\n\n## {background-image=\"https://preview.redd.it/8ruxxxe7d9d31.jpg?auto=webp&s=8aea753b10e0c1346031283090c9d589ae953c14\"}\n\n## \n<div class=\"tenor-gif-embed\" data-postid=\"7671930\" data-share-method=\"host\" data-aspect-ratio=\"1.35135\" data-width=\"100%\"><a href=\"https://tenor.com/view/lady-and-the-tramp-dog-eat-spaghetti-kiss-gif-7671930\">Lady And The Tramp Dog GIF</a>from <a href=\"https://tenor.com/search/lady+and+the+tramp-gifs\">Lady And The Tramp GIFs</a></div> <script type=\"text/javascript\" async src=\"https://tenor.com/embed.js\"></script>\"\n\n## Data exploration\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>% # take the opbject penguins\n  write.csv(., \"penguins.csv\") # then, save as .csv\n```\n:::\n\n\n:::{.fragment}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>% \n  summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      species          island    bill_length_mm  bill_depth_mm  \n Adelie   :152   Biscoe   :168   Min.   :32.10   Min.   :13.10  \n Chinstrap: 68   Dream    :124   1st Qu.:39.23   1st Qu.:15.60  \n Gentoo   :124   Torgersen: 52   Median :44.45   Median :17.30  \n                                 Mean   :43.92   Mean   :17.15  \n                                 3rd Qu.:48.50   3rd Qu.:18.70  \n                                 Max.   :59.60   Max.   :21.50  \n                                 NA's   :2       NA's   :2      \n flipper_length_mm  body_mass_g       sex           year     \n Min.   :172.0     Min.   :2700   female:165   Min.   :2007  \n 1st Qu.:190.0     1st Qu.:3550   male  :168   1st Qu.:2007  \n Median :197.0     Median :4050   NA's  : 11   Median :2008  \n Mean   :200.9     Mean   :4202                Mean   :2008  \n 3rd Qu.:213.0     3rd Qu.:4750                3rd Qu.:2009  \n Max.   :231.0     Max.   :6300                Max.   :2009  \n NA's   :2         NA's   :2                                 \n```\n\n\n:::\n:::\n\n\n:::\n\n## Types of variable\n\n\n::: {.cell output-location='default'}\n\n```{.r .cell-code}\npenguins %>% \n  str()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntibble [344 × 8] (S3: tbl_df/tbl/data.frame)\n $ species          : Factor w/ 3 levels \"Adelie\",\"Chinstrap\",..: 1 1 1 1 1 1 1 1 1 1 ...\n $ island           : Factor w/ 3 levels \"Biscoe\",\"Dream\",..: 3 3 3 3 3 3 3 3 3 3 ...\n $ bill_length_mm   : num [1:344] 39.1 39.5 40.3 NA 36.7 39.3 38.9 39.2 34.1 42 ...\n $ bill_depth_mm    : num [1:344] 18.7 17.4 18 NA 19.3 20.6 17.8 19.6 18.1 20.2 ...\n $ flipper_length_mm: int [1:344] 181 186 195 NA 193 190 181 195 193 190 ...\n $ body_mass_g      : int [1:344] 3750 3800 3250 NA 3450 3650 3625 4675 3475 4250 ...\n $ sex              : Factor w/ 2 levels \"female\",\"male\": 2 1 1 NA 1 2 1 2 NA NA ...\n $ year             : int [1:344] 2007 2007 2007 2007 2007 2007 2007 2007 2007 2007 ...\n```\n\n\n:::\n:::\n\n\n\n\n## Types of variables\n\n::::{.columns}\n:::{.column .fragment}\n**Categorical**\n\n![](https://static-assets.codecademy.com/Courses/Hypothesis-Testing/Intro_to_variable_types_3.png)\n\n:::\n\n:::{.column .fragment}\n**Numerical**\n\n![](https://static-assets.codecademy.com/Courses/Hypothesis-Testing/Intro_to_variable_types_4.png)\n\n:::\n::::\n\n## Summarising data\n\n\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\nlibrary(vtable)\nlibrary(gt)\n\npenguins %>% \n  vtable(., lush = TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>.</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Name </th>\n   <th style=\"text-align:left;\"> Class </th>\n   <th style=\"text-align:left;\"> Values </th>\n   <th style=\"text-align:left;\"> Missing </th>\n   <th style=\"text-align:left;\"> Summary </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> species </td>\n   <td style=\"text-align:left;\"> factor </td>\n   <td style=\"text-align:left;\"> 'Adelie' 'Chinstrap' 'Gentoo' </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> nuniq: 3 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> island </td>\n   <td style=\"text-align:left;\"> factor </td>\n   <td style=\"text-align:left;\"> 'Biscoe' 'Dream' 'Torgersen' </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> nuniq: 3 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> bill_length_mm </td>\n   <td style=\"text-align:left;\"> numeric </td>\n   <td style=\"text-align:left;\"> Num: 32.1 to 59.6 </td>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:left;\"> mean: 43.922, sd: 5.46, nuniq: 164 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> bill_depth_mm </td>\n   <td style=\"text-align:left;\"> numeric </td>\n   <td style=\"text-align:left;\"> Num: 13.1 to 21.5 </td>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:left;\"> mean: 17.151, sd: 1.975, nuniq: 80 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> flipper_length_mm </td>\n   <td style=\"text-align:left;\"> integer </td>\n   <td style=\"text-align:left;\"> Num: 172 to 231 </td>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:left;\"> mean: 200.915, sd: 14.062, nuniq: 55 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> body_mass_g </td>\n   <td style=\"text-align:left;\"> integer </td>\n   <td style=\"text-align:left;\"> Num: 2700 to 6300 </td>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:left;\"> mean: 4201.754, sd: 801.955, nuniq: 94 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> sex </td>\n   <td style=\"text-align:left;\"> factor </td>\n   <td style=\"text-align:left;\"> 'female' 'male' </td>\n   <td style=\"text-align:left;\"> 11 </td>\n   <td style=\"text-align:left;\"> nuniq: 2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> year </td>\n   <td style=\"text-align:left;\"> integer </td>\n   <td style=\"text-align:left;\"> Num: 2007 to 2009 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> mean: 2008.029, sd: 0.818, nuniq: 3 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n## Summarising data\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\nlibrary(vtable)\nlibrary(gt)\n\npenguins %>% \n  group_by(species) %>% \n  na.omit() %>% \n  summarise(mean = mean(bill_length_mm), sd=sd(bill_length_mm), n = n())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 4\n  species    mean    sd     n\n  <fct>     <dbl> <dbl> <int>\n1 Adelie     38.8  2.66   146\n2 Chinstrap  48.8  3.34    68\n3 Gentoo     47.6  3.11   119\n```\n\n\n:::\n:::\n\n\n\n![](https://dplyr.tidyverse.org/logo.png){.absolute bottom=15 right=10 fig-size=6}\n\nMore codes [here](https://dplyr.tidyverse.org/reference/summarise.html)\n\n## Your turn\n\n- Try to reproduce\n- Create any summary for \"penguins\"\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"countdown\" id=\"timer_c328c9d9\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">02</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">15</span></code>\n</div>\n```\n\n:::\n:::\n\n\n\n## This goes on and on...\n\n- Data exploration goes as far and deep as you need\n- There is no minimum nor maximum\n- The key point is\n\n\n**This needs to make your data make sense to you**\n\n## Subset data\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\npenguins %>% \n  select(body_mass_g)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 344 × 1\n   body_mass_g\n         <int>\n 1        3750\n 2        3800\n 3        3250\n 4          NA\n 5        3450\n 6        3650\n 7        3625\n 8        4675\n 9        3475\n10        4250\n# ℹ 334 more rows\n```\n\n\n:::\n:::\n\n\n\n## Subset data\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\npenguins %>% \n  filter(species==\"Gentoo\", \n         bill_length_mm > 50, \n         sex==\"male\") %>% \n  select(bill_length_mm, \n         bill_depth_mm) %>% \n  arrange(bill_depth_mm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 21 × 2\n   bill_length_mm bill_depth_mm\n            <dbl>         <dbl>\n 1           51.3          14.2\n 2           50.2          14.3\n 3           50.1          15  \n 4           50.7          15  \n 5           50.4          15.3\n 6           52.5          15.6\n 7           54.3          15.7\n 8           50.8          15.7\n 9           50.4          15.7\n10           53.4          15.8\n# ℹ 11 more rows\n```\n\n\n:::\n:::\n\n\n\n## Add new columns\n\n\n\n::: {.cell output-location='default'}\n\n```{.r .cell-code  code-line-numbers=\"6\"}\npenguins %>% \n  select(bill_length_mm, \n         bill_depth_mm) %>% \n  mutate(bill_volume=bill_length_mm+bill_depth_mm) %>% \n  mutate(log_bill_volume=log(bill_volume)) %>% \n  mutate(bill_categ=ifelse(bill_volume<60, \"small\", \"big\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 344 × 5\n   bill_length_mm bill_depth_mm bill_volume log_bill_volume bill_categ\n            <dbl>         <dbl>       <dbl>           <dbl> <chr>     \n 1           39.1          18.7        57.8            4.06 small     \n 2           39.5          17.4        56.9            4.04 small     \n 3           40.3          18          58.3            4.07 small     \n 4           NA            NA          NA             NA    <NA>      \n 5           36.7          19.3        56              4.03 small     \n 6           39.3          20.6        59.9            4.09 small     \n 7           38.9          17.8        56.7            4.04 small     \n 8           39.2          19.6        58.8            4.07 small     \n 9           34.1          18.1        52.2            3.96 small     \n10           42            20.2        62.2            4.13 big       \n# ℹ 334 more rows\n```\n\n\n:::\n:::\n\n\n\n## Reshape data [Tidyr](https://github.com/rstudio/cheatsheets/blob/main/tidyr.pdf)\nLong format\n\n\n\n::: {.cell output-location='default'}\n\n```{.r .cell-code  code-line-numbers=\"6\"}\npenguins %>% \n  select(bill_length_mm, \n         bill_depth_mm,\n         year) %>% \n  pivot_longer(col=c(bill_length_mm:bill_depth_mm), \n               names_to = \"bill_feature\", values_to = \"value\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 688 × 3\n    year bill_feature   value\n   <int> <chr>          <dbl>\n 1  2007 bill_length_mm  39.1\n 2  2007 bill_depth_mm   18.7\n 3  2007 bill_length_mm  39.5\n 4  2007 bill_depth_mm   17.4\n 5  2007 bill_length_mm  40.3\n 6  2007 bill_depth_mm   18  \n 7  2007 bill_length_mm  NA  \n 8  2007 bill_depth_mm   NA  \n 9  2007 bill_length_mm  36.7\n10  2007 bill_depth_mm   19.3\n# ℹ 678 more rows\n```\n\n\n:::\n:::\n\n\n\n![](https://tidyr.tidyverse.org/logo.png){.absolute bottom=10 right=10}\n\n## Reshape data [Tidyr](https://github.com/rstudio/cheatsheets/blob/main/tidyr.pdf)\nWide format\n\n\n\n::: {.cell output-location='default'}\n\n```{.r .cell-code  code-line-numbers=\"6\"}\npenguins %>% \n  mutate(row = row_number()) %>% # needed to add a rwoo number to identify each row as separate case\n  select(row, species, island, body_mass_g) %>% \n  pivot_wider(names_from = island, values_from = body_mass_g)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 344 × 5\n     row species Torgersen Biscoe Dream\n   <int> <fct>       <int>  <int> <int>\n 1     1 Adelie       3750     NA    NA\n 2     2 Adelie       3800     NA    NA\n 3     3 Adelie       3250     NA    NA\n 4     4 Adelie         NA     NA    NA\n 5     5 Adelie       3450     NA    NA\n 6     6 Adelie       3650     NA    NA\n 7     7 Adelie       3625     NA    NA\n 8     8 Adelie       4675     NA    NA\n 9     9 Adelie       3475     NA    NA\n10    10 Adelie       4250     NA    NA\n# ℹ 334 more rows\n```\n\n\n:::\n:::\n\n\n\n\n\n## Your turn\n\n- Try to reproduce\n- Create any wide and long formats for \"penguins\"\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"countdown\" id=\"timer_f2e69470\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">03</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">15</span></code>\n</div>\n```\n\n:::\n:::\n\n\n\n## The correct data format\n\n![](https://ohi-science.org/data-science-training/img/tidy_data.png)\n\n\n## End of session on DA {.center}\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/countdown-0.4.0/countdown.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/countdown-0.4.0/countdown.js\"></script>\n<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}