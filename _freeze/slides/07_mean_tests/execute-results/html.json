{
  "hash": "2c1267864882e484c8103131d7214a3e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"7-Mean Tests\"\nsubtitle: \" \"\nauthor: \"Felipe Melo\"\ninstitute: \"Nottingham Trent University - UK\"\nfrom: markdown+emoji\nformat:\n  revealjs:\n    theme: [default, custom.scss]\n    incremental: false\n    chalkboard: true\n    logo: img/ntu_logo.png\n    footer: \"Research Methods & Data Analysis\"\n    slide-number: true\n    transition: slide\n    background-transition: fade\n    #auto-stretch: true\n    title-block-banner: true\n\n---\n\n::: {.cell}\n\n:::\n\n\n\n\n## You should know today:\n\n- Know when to use mean tests\n- Understand means and variances\n- Parametric nd non-parametric versions\n- T-tests, ANOVA, etc...\n- Paired tests\n\n\n## Types of variables (review)\n\n::::{.columns}\n:::{.column .fragment}\n**Categorical**\n\n![](https://static-assets.codecademy.com/Courses/Hypothesis-Testing/Intro_to_variable_types_3.png)\n\n:::\n\n:::{.column .fragment}\n**Numerical**\n\n![](https://static-assets.codecademy.com/Courses/Hypothesis-Testing/Intro_to_variable_types_4.png)\n\n:::\n::::\n\n## Back to the toolbox\n\n![](img/toolkit.png){fig-align=\"center\"}\n\n## Basics\n\n![](img/comparing-means.png){fig-align=\"center\"}\n\n## One-Sample\n\n![](https://statstest.b-cdn.net/wp-content/uploads/2020/02/Single-Sample-T-Test-1-1024x512.png)\n\n## Assumptions\n\n- Continuous\n- Normally Distributed\n- Random Sample\n- Enough Data\n\n![](https://statstest.b-cdn.net/wp-content/uploads/2020/02/Screen-Shot-2020-02-06-at-5.23.39-PM.png){.absolute right=10 top=30 width=50%}\n\n## Let's code it\n\n:::{.panel-tabset}\n\n## Penguins\n\n![](https://allisonhorst.github.io/palmerpenguins/reference/figures/lter_penguins.png){width=\"40%\" fig-align=\"left\"}\n\n![](https://allisonhorst.github.io/palmerpenguins/reference/figures/culmen_depth.png){.absolute width=\"40%\" right=10 bottom=80}\n\n## Code\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(586)\nx<-rnorm(50)\nt.test(x, mu = 0, alternative = \"two.sided\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tOne Sample t-test\n\ndata:  x\nt = -0.31154, df = 49, p-value = 0.7567\nalternative hypothesis: true mean is not equal to 0\n95 percent confidence interval:\n -0.2633214  0.1926358\nsample estimates:\n  mean of x \n-0.03534281 \n```\n\n\n:::\n:::\n\n\n\n## Example\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>% \n  filter(species==\"Adelie\") %>% \n  select(bill_length_mm)->x\n\nt.test(x, mu = 43.92, alternative = \"two.sided\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tOne Sample t-test\n\ndata:  x\nt = -23.662, df = 150, p-value < 2.2e-16\nalternative hypothesis: true mean is not equal to 43.92\n95 percent confidence interval:\n 38.36312 39.21966\nsample estimates:\nmean of x \n 38.79139 \n```\n\n\n:::\n:::\n\n\n\n## Graph\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\npenguins %>% \nggdensity(x = \"bill_length_mm\",\n   add = \"mean\", rug = TRUE,\n   color = \"#00AFBB\", fill = \"#00AFBB\")+\n  geom_vline(xintercept = 38.79139)\n```\n\n::: {.cell-output-display}\n![](07_mean_tests_files/figure-revealjs/unnamed-chunk-4-1.png){width=960}\n:::\n:::\n\n\n:::\n\n## One-sided differences\n:::{.panel-tabset}\n## Context\n\n<a href=\"https://www.statista.com/statistics/1093256/novel-coronavirus-2019ncov-deaths-worldwide-by-country/\" rel=\"nofollow\"><img src=\"https://www.statista.com/graphic/1/1093256/novel-coronavirus-2019ncov-deaths-worldwide-by-country.jpg\" alt=\"Statistic: Number of novel coronavirus (COVID-19) deaths worldwide as of May 2, 2023, by country and territory | Statista\" style=\"width: 100%; height: auto !important; max-width:1000px;-ms-interpolation-mode: bicubic;\"/></a><br />Find more statistics at  <a href=\"https://www.statista.com\" rel=\"nofollow\">Statista</a>\n\n## Code\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\n# Fetch the data from Our World in Data. RUN ONLY ONCE\nurl <- \"https://covid.ourworldindata.org/data/owid-covid-data.csv\"\ndf <- read_csv(url)\n\n# Prepare the data\ndf_latest <- df %>%\n  group_by(location) %>%\n  slice_tail(n = 1) %>%\n  mutate(deaths_per_million = total_deaths / population * 1000000)\ndf_latest %>% \n  filter(location==\"Brazil\") %>% \n  select(deaths_per_million)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 2\n# Groups:   location [1]\n  location deaths_per_million\n  <chr>                 <dbl>\n1 Brazil                3261.\n```\n\n\n:::\n:::\n\n\n\n## Plot\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\nggplot(df_latest, aes(x = deaths_per_million)) +\n  geom_histogram(fill = \"steelblue\") +\n  labs(title = \"COVID-19 Deaths per Million\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))+\n  geom_vline(xintercept=3261)\n```\n\n::: {.cell-output-display}\n![](07_mean_tests_files/figure-revealjs/unnamed-chunk-6-1.png){width=960}\n:::\n:::\n\n\n## t-test\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\nt.test(df_latest$deaths_per_million, \n       mu = 3261, \n       alternative = \"less\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tOne Sample t-test\n\ndata:  df_latest$deaths_per_million\nt = -23.694, df = 233, p-value < 2.2e-16\nalternative hypothesis: true mean is less than 3261\n95 percent confidence interval:\n     -Inf 1385.595\nsample estimates:\nmean of x \n 1245.092 \n```\n\n\n:::\n:::\n\n\n\n## Is it normal?\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\nshapiro.test(df_latest$deaths_per_million) ## Non-normal!!\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  df_latest$deaths_per_million\nW = 0.8578, p-value = 6.709e-14\n```\n\n\n:::\n:::\n\n\n\n## Non-parametirc test\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\nwilcox.test(df_latest$deaths_per_million,\n            mu = 3261,\n            alternative = \"less\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWilcoxon signed rank test with continuity correction\n\ndata:  df_latest$deaths_per_million\nV = 910, p-value < 2.2e-16\nalternative hypothesis: true location is less than 3261\n```\n\n\n:::\n:::\n\n\n\n:::\n\n\n\n## Two independent groups\n:::{.panel-tabset}\n## Data\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\n# Data in two numeric vectors\nwomen_weight <- c(38.9, 61.2, 73.3, 21.8, 63.4, 64.6, 48.4, 48.8, 48.5)\nmen_weight <- c(67.8, 60, 63.4, 76, 89.4, 73.3, 67.3, 61.3, 62.4) \n# Create a data frame\nmy_data <- data.frame( \n                group = rep(c(\"Woman\", \"Man\"), each = 9),\n                weight = c(women_weight,  men_weight)\n                )\nmy_data\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   group weight\n1  Woman   38.9\n2  Woman   61.2\n3  Woman   73.3\n4  Woman   21.8\n5  Woman   63.4\n6  Woman   64.6\n7  Woman   48.4\n8  Woman   48.8\n9  Woman   48.5\n10   Man   67.8\n11   Man   60.0\n12   Man   63.4\n13   Man   76.0\n14   Man   89.4\n15   Man   73.3\n16   Man   67.3\n17   Man   61.3\n18   Man   62.4\n```\n\n\n:::\n:::\n\n\n\n## Plot\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\nlibrary(\"ggpubr\")\nggboxplot(my_data, x = \"group\", y = \"weight\", \n          color = \"group\", palette = c(\"#00AFBB\", \"#E7B800\"),\n        ylab = \"Weight\", xlab = \"Groups\")\n```\n\n::: {.cell-output-display}\n![](07_mean_tests_files/figure-revealjs/unnamed-chunk-11-1.png){width=960}\n:::\n:::\n\n\n## Check assumptions\n\n- Are the two samples independents?\n- Are the data from each of the 2 groups follow a normal distribution?\n- Do the two populations have the same variances?\n\n:::\n\n## Testing normal distribution\n\n\n\n::: {.cell output-location='default'}\n\n```{.r .cell-code}\n# Shapiro-Wilk normality test for Men's weights\nwith(my_data, shapiro.test(weight[group == \"Man\"]))# p = 0.1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  weight[group == \"Man\"]\nW = 0.86425, p-value = 0.1066\n```\n\n\n:::\n\n```{.r .cell-code}\n# Shapiro-Wilk normality test for Women's weights\nwith(my_data, shapiro.test(weight[group == \"Woman\"])) # p = 0.6\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  weight[group == \"Woman\"]\nW = 0.94266, p-value = 0.6101\n```\n\n\n:::\n:::\n\n\n\n## Testing equal variances\n\n\n\n::: {.cell output-location='default'}\n\n```{.r .cell-code}\nvar.test(weight ~ group, data = my_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tF test to compare two variances\n\ndata:  weight by group\nF = 0.36134, num df = 8, denom df = 8, p-value = 0.1714\nalternative hypothesis: true ratio of variances is not equal to 1\n95 percent confidence interval:\n 0.08150656 1.60191315\nsample estimates:\nratio of variances \n         0.3613398 \n```\n\n\n:::\n:::\n\n\n\n## Unpaired two-samples t-test\n\n\n\n::: {.cell output-location='default'}\n\n```{.r .cell-code}\nt.test(women_weight, men_weight, var.equal = TRUE) # method 1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tTwo Sample t-test\n\ndata:  women_weight and men_weight\nt = -2.7842, df = 16, p-value = 0.01327\nalternative hypothesis: true difference in means is not equal to 0\n95 percent confidence interval:\n -29.748019  -4.029759\nsample estimates:\nmean of x mean of y \n 52.10000  68.98889 \n```\n\n\n:::\n\n```{.r .cell-code}\nt.test(weight ~ group, data = my_data, var.equal = TRUE) # Method 2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tTwo Sample t-test\n\ndata:  weight by group\nt = 2.7842, df = 16, p-value = 0.01327\nalternative hypothesis: true difference in means between group Man and group Woman is not equal to 0\n95 percent confidence interval:\n  4.029759 29.748019\nsample estimates:\n  mean in group Man mean in group Woman \n           68.98889            52.10000 \n```\n\n\n:::\n:::\n\n\n\n## Non-parametric test\n::: {.panel-tabset}\n## Wilcoxon\n![](https://datatab.net/assets/tutorial/Wilcoxon-Test.png)\n\nsource:<https://datatab.net/tutorial/wilcoxon-test>\n\n## Data\n\n\n::: {.cell output-location='default'}\n\n```{.r .cell-code}\nmy_data %>% \n  mutate(subject = rep(1:9,2)) %>%\n  pivot_wider(names_from = group, \n              values_from = weight) %>% \n  mutate(diff=Woman-Man) %>% \n  arrange(diff) %>% \n  mutate(signal=ifelse(diff>0, \"pos\", \"neg\")) %>% \n  mutate(rank=9:1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 9 × 6\n  subject Woman   Man   diff signal  rank\n    <int> <dbl> <dbl>  <dbl> <chr>  <int>\n1       4  21.8  76   -54.2  neg        9\n2       1  38.9  67.8 -28.9  neg        8\n3       5  63.4  89.4 -26    neg        7\n4       7  48.4  67.3 -18.9  neg        6\n5       9  48.5  62.4 -13.9  neg        5\n6       8  48.8  61.3 -12.5  neg        4\n7       6  64.6  73.3  -8.7  neg        3\n8       2  61.2  60     1.20 pos        2\n9       3  73.3  63.4   9.9  pos        1\n```\n\n\n:::\n:::\n\n\n\n## Calculaion\n\n![](https://datatab.net/assets/tutorial/Calculate-Wilcoxon-test.png)\n\n## Code\n\n\n\n::: {.cell output-location='default'}\n\n```{.r .cell-code}\nwilcox.test(weight ~ group, data = my_data,\n                   exact = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWilcoxon rank sum test with continuity correction\n\ndata:  weight by group\nW = 66, p-value = 0.02712\nalternative hypothesis: true location shift is not equal to 0\n```\n\n\n:::\n:::\n\n\n:::\n\n## More than two independent groups\n:::{.panel-tabset}\n## Context\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](07_mean_tests_files/figure-revealjs/unnamed-chunk-17-1.png){width=960}\n:::\n:::\n\n\n\n\n## ANOVA\n\n\n\n::: {.cell output-location='default'}\n\n```{.r .cell-code}\nanova(lm(bill_length_mm~species, data=penguins))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: bill_length_mm\n           Df Sum Sq Mean Sq F value    Pr(>F)    \nspecies     2 7194.3  3597.2   410.6 < 2.2e-16 ***\nResiduals 339 2969.9     8.8                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n## Sum of Squares\n$$SS=\\sum_{i=0}^{n} (X_i - \\bar{X})^2$$\n\nSee [this video](https://www.youtube.com/watch?v=8PEMXgayXBg) to understand the logic of an ANOVA\n\n## Visualising\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](07_mean_tests_files/figure-revealjs/unnamed-chunk-19-1.png){width=960}\n:::\n:::\n\n\n\n\n:::\n\n## Anova Table\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|Source of Variation   | Sum of Squares (SS)| Degrees of Freedom (df)| Mean Square (MS)| F-value| p-value|\n|:---------------------|-------------------:|-----------------------:|----------------:|-------:|-------:|\n|Between Groups        |                 100|                       2|            50.00|     4.5|    0.05|\n|Within Groups (Error) |                 200|                      15|            13.33|      NA|      NA|\n|Total                 |                 300|                      17|               NA|      NA|      NA|\n\n\n:::\n:::\n\n\n\n## Kruskal-Wallis (non-parametric)\n\n\n\n::: {.cell output-location='default'}\n\n```{.r .cell-code}\nkruskal.test(bill_length_mm~species, data=penguins)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tKruskal-Wallis rank sum test\n\ndata:  bill_length_mm by species\nKruskal-Wallis chi-squared = 244.14, df = 2, p-value < 2.2e-16\n```\n\n\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](07_mean_tests_files/figure-revealjs/unnamed-chunk-22-1.png){width=960}\n:::\n:::\n\n\n\n\n## Paired designs\n\n![](img/paired.png){fig-align=center}\n\n## Paired graphs\n:::{.panel-tabset}\n## Pairs in space\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\n# Weight of the mice before treatment\nblockA <-c(200.1, 190.9, 192.7, 213, 241.4, 196.9, 172.2, 185.5, 205.2, 193.7)\n# Weight of the mice after treatment\nblockB <-c(392.9, 393.2, 345.1, 393, 434, 427.9, 422, 383.9, 392.3, 352.2)\n# Create a data frame\nmy_data2 <- data.frame( \n                group = rep(c(\"blockA\", \"blockB\"), each = 10),\n                weight = c(blockA,  blockB)\n                )\n\nmy_data2 %>% \n  mutate(subject=rep(1:10,2)) %>% \n  ggplot(aes(group,weight))+\n  geom_boxplot(aes(fill=group), alpha=0.5)+\n  geom_line(aes(group=subject))+\n  geom_point(size=2)\n```\n\n::: {.cell-output-display}\n![](07_mean_tests_files/figure-revealjs/unnamed-chunk-23-1.png){width=960}\n:::\n:::\n\n\n\n## Pairs in time\n![](img/phylo.png){fig-align=\"center\" width=\"60%\"}\n\nsource: [Santos et al 2015](https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0113109)\n\n:::\n\n## More than two independent samples\n:::{.panel-tabset}\n## 2-way ANOVA graph\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\nToothGrowth$dose<-as.factor(ToothGrowth$dose)\nToothGrowth %>% \n  ggboxplot(x = \"dose\", y = \"len\", color = \"supp\",\n          palette = c(\"#00AFBB\", \"#E7B800\"))\n```\n\n::: {.cell-output-display}\n![](07_mean_tests_files/figure-revealjs/unnamed-chunk-24-1.png){width=960}\n:::\n:::\n\n\n\n## 2-way ANOVA Code\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanova(lm(len~dose+supp, data = ToothGrowth))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: len\n          Df  Sum Sq Mean Sq F value    Pr(>F)    \ndose       2 2426.43 1213.22  82.811 < 2.2e-16 ***\nsupp       1  205.35  205.35  14.017 0.0004293 ***\nResiduals 56  820.43   14.65                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n## 2-way ANOVA with interaction\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# These two calls are equivalent\nres.aov3 <- aov(len ~ supp * dose, data = ToothGrowth)\nres.aov3 <- aov(len ~ supp + dose + supp:dose, data = ToothGrowth)\nsummary(res.aov3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            Df Sum Sq Mean Sq F value   Pr(>F)    \nsupp         1  205.4   205.4  15.572 0.000231 ***\ndose         2 2426.4  1213.2  92.000  < 2e-16 ***\nsupp:dose    2  108.3    54.2   4.107 0.021860 *  \nResiduals   54  712.1    13.2                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n:::\n\n## Post-hoc comparisons\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nTukeyHSD(res.aov3, which = \"dose\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Tukey multiple comparisons of means\n    95% family-wise confidence level\n\nFit: aov(formula = len ~ supp + dose + supp:dose, data = ToothGrowth)\n\n$dose\n        diff       lwr       upr   p adj\n1-0.5  9.130  6.362488 11.897512 0.0e+00\n2-0.5 15.495 12.727488 18.262512 0.0e+00\n2-1    6.365  3.597488  9.132512 2.7e-06\n```\n\n\n:::\n:::\n\n\n\n\n\n## End of DA class{.center}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "supporting": [
      "07_mean_tests_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}